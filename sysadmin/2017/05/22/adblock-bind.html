<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>AdBlock on mobile without root</title>
  <meta name="description" content="How to use AdBlock on my android phone without rooting it.">
  <meta name="keywords" content="blog, Mathieu Rousse, linux, pentest, challenge, ctf, writeup">
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,300,500,600&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.min.css">
  <link rel="canonical" href="https://math.rousse.me/sysadmin/2017/05/22/adblock-bind.html">
  <link rel="alternate" type="application/rss+xml" title="Last code until midnight" href="https://math.rousse.me/feed.xml">
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Person",
    "name": "Mathieu Rousse",
    "url": "https://math.rousse.me",
    "sameAs": [
      "https://fr.linkedin.com/in/mathieurousse",
      "https://github.com/m-rousse"
    ]
  }
  </script>
  <script>
    (function(h,o,u,n,d) {
      h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
      d=o.createElement(u);d.async=1;d.src=n
      n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
    })(window,document,'script','https://www.datadoghq-browser-agent.com/datadog-rum-v4.js','DD_RUM')
    DD_RUM.onReady(function() {
      DD_RUM.init({
        clientToken: 'pub5e022b5673a75a3e62659ed01005bfb2',
        applicationId: 'c5f01a98-9117-42ce-8ca1-35cb8fac73a5',
        site: 'datadoghq.com',
        service:'personal-blog',
        env:'prod',
        // Specify a version number to identify the deployed version of your application in Datadog
        // version: '1.0.0',
        sampleRate: 100,
        trackInteractions: true,
        defaultPrivacyLevel: 'mask-user-input'
      });

      DD_RUM.startSessionReplayRecording();
    })
  </script>
</head>


  <body>

    <div class="container">

      <div class="header clearfix">

  <nav class="navbar navbar-light bg-faded" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <a class="navbar-brand" href="/">Last code until midnight</a>
    <ul class="nav navbar-nav pull-right">
      <li class="nav-item"><a class="nav-link" itemprop="url" href="/"><span itemprop="name">Home</span></a></li>
      <li class="nav-item"><a class="nav-link" itemprop="url" href="/projects/"><span itemprop="name">Projects</span></a></li>
      <li class="nav-item"><a class="nav-link" itemprop="url" href="/about/"><span itemprop="name">About</span></a></li>
    </ul>
  </nav>
</div>


      <div class="container">
  <h1 class="title">AdBlock on mobile without root</h1>

  <p class="title-date"><small class="text-muted">May 22, 2017</small></p>

  <p>My smartphone is under android and used to be rooted. Many applications refuse to start if they detect that the phone has been rooted (either via scanning running processes or simply by looking for a <code class="language-plaintext highlighter-rouge">su</code> executable).</p>

<p>On the other hand, I do not like advertisements and find more and more of them in the applications I use every day.</p>

<!---excerpt-break-->

<p>The first solution I chose was <a href="https://adaway.org/">AdAway</a>, which needed root permissions, but was quite efficient. It adds to the <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file entries to redirect the domain names used by advertisements companies to <code class="language-plaintext highlighter-rouge">localhost</code> (which does not run any webserver). It worked great until I wanted to use an application enemy of rooted phones.</p>

<p>So the second solution I came up with was to set up a DNS server that would resolve the domain names of advertisements companies to <code class="language-plaintext highlighter-rouge">localhost</code>, and to set my phone to use this DNS server instead.</p>

<blockquote>
  <p>I will not describe how to set up a DNS server nor how to configure the phone to use the DNS server (it could be an internet accessible server, LAN only or even through a VPN).</p>
</blockquote>

<p>First I made a script to fetch the blacklisted domains used by AdAway and generate a zone file usable by Bind.</p>

<script src="https://gist.github.com/m-rousse/e126f628f3f8994ef515079d8426965a.js"> </script>

<p>It generates a big <code class="language-plaintext highlighter-rouge">blacklisted.zones</code> file with for each domain an entry like so :</p>

<div><pre class="language-bash line-numbers">
<code class="language-bash">...
zone "ad.domain.com" {type master; allow-update{ key "rdnc-key"; }; file "/var/named/sinkhole.zone";};
...</code></pre></div>

<p>You can include directely this file in Bind :</p>

<div><pre class="language-bash line-numbers">
<code class="language-bash">check-names master ignore;
check-names slave  ignore;

include "/path/to/blacklisted.zones";</code></pre></div>

<p>To finish, you need the <code class="language-plaintext highlighter-rouge">sinkhole.zone</code> file that resolves the domain to <code class="language-plaintext highlighter-rouge">localhost</code>.</p>

<div><pre class="language-bash line-numbers">
<code class="language-bash">$TTL 86400
@       IN SOA server.domain.name. hostmaster.domain.name. (2016121219 86400 3600 3600000 300)
@       IN NS     domain.name.
@               A       127.0.0.1
*       IN      A       127.0.0.1
@               AAAA    ::1
*       IN      AAAA    ::1</code></pre></div>

<p>Thatâ€™s it ! Now, advertisements do not load and I can peacefully look at kittens online without most ads !</p>

<p>Note : Another project already addressed this issue (using DNSMasq, LightHTTPd and a Raspberry Pi) : <a href="https://pi-hole.net/">Pi-Hole</a></p>


</div>


      <hr>

      <div class="container">

  <div class="row">

    <div class="col-md-6">
      <ul class="list-unstyled">
        <li><a id="contactAdd"><i class="fa fa-envelope-o fa-fw"></i> mathieu at rousse d0t me</a></li>
        <li><a href="/feed.xml"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      </ul>
    </div>

    <div class="col-md-6">
      <div class="footer-col footer-col-2">
        <ul class="list-unstyled">
          
          <li>
            <a href="https://github.com/m-rousse"><i class="fa fa-github fa-fw"></i><span class="username">m-rousse</span></a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/roussemath"><i class="fa fa-twit-icon fa-fw"></i><span class="username">roussemath</span></a>
          </li>
          

          
          <li>
            <a href="https://fr.linkedin.com/in/mathieurousse"><i class="fa fa-lin fa-fw"></i><span class="username">mathieurousse</span></a>
          </li>
          
        </ul>
      </div>

    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <p class="text-muted">The blog of an IT and security enthusiast.</p>
    </div>
  </div>
</div>
<script type="text/javascript" src="/js/LastLineUntilMidnight.min.js"></script>

    </div>

  </body>

</html>
