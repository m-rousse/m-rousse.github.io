---
layout: post
title:  "sCTF.io Q1"
date:   2016-04-19 22:34:18 +0200
categories: ctf
---

A week ago, I took part of the sCTF.io 2016 Q1 with a friend. This is the first time I take seriously part to a CTF. We managed to score 1700 points and ranked 7th of about 700 teams (Funpetitor for us as we do not live in US).

{% lightbox sctfio-2016q1.png %}

Here are a few notes about problems we solved and found interesting.

### Rev1

I used IDA during the challenge, but as I want to practice with radare2 the write up will be using radare2.

First, I ran the program to have an idea of what to look for.

<div><pre class="language-bash line-numbers">
<code class="language-bash">root@kali:~/sCTF/Rev1# ./rev1
What is the magic password?
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
</code></pre></div>

So it does not print anything if the password is wrong. It's time to fire radare2 !

<div><pre class="language-nasm line-numbers">
<code class="language-nasm">[0x00400560]> aaa
[0x00400560]> iz
vaddr=0x00400744 paddr=0x00000744 ordinal=000 sz=28 len=27 section=.rodata type=a string=What is the magic password?
vaddr=0x00400763 paddr=0x00000763 ordinal=001 sz=26 len=25 section=.rodata type=a string=Correct! Your flag is: %s

[0x00400560]> pd 10 @ 0x00400744-5
|          0x0040073f    0001           add byte [rcx], al
|          ;-- sym._IO_stdin_used:
|          ;-- section..rodata:
|          0x00400740    0100           add dword [rax], eax           ; [14] va=0x00400740 pa=0x00000740 sz=61 vsz=61 rwx=-r-- .rodata
|          0x00400742    0200           add al, byte [rax]
|          ; DATA XREF from 0x00400677 (sym.main)
|          ;-- str.What_is_the_magic_password_:
|          0x00400744     .string "What is the magic password?" ; len=28
|      |   ; DATA XREF from 0x00400688 (sym.main)
       |   0x00400760    256400436f     and eax, 0x6f430064
|      |   ; DATA XREF from 0x004006a8 (sym.main)
       |   ;-- str.Correct__Your_flag_is:__s:                 ; ignore this__
       |   0x00400763     .string "Correct! Your flag is: %s" ; len=26
           ;-- section_end..rodata:
           0x0040077d    0000           add byte [rax], al
           0x0040077f    0001           add byte [rcx], al
           ;-- section..eh_frame_hdr:
           0x00400780    011b           add dword [rbx], ebx           ; [15] va=0x00400780 pa=0x00000780 sz=52 vsz=52 rwx=-r-- .eh_frame_hdr
           0x00400782    033b           add edi, dword [rbx]
[0x00400560]> s 0x00400677
[0x00400677]> pdf @ 0x00400677
/ (fcn) sym.main 104
|          ; var int local_0_4    @ rbp-0x4
|          ; var int local_1      @ rbp-0x8
|          ; var int local_2      @ rbp-0x10
|          ; DATA XREF from 0x0040057d (entry0)
|          ;-- main:
|          ;-- sym.main:
|          0x00400656    55             push rbp
|          0x00400657    4889e5         mov rbp, rsp
|          0x0040065a    4883ec10       sub rsp, 0x10
|          0x0040065e    c745fc000000.  mov dword [rbp-local_0_4], 0
|          0x00400665    48b868347830.  movabs rax, 0x2121217230783468
|          0x0040066f    488945f0       mov qword [rbp-local_2], rax
|          0x00400673    c645f800       mov byte [rbp-local_1], 0
|          0x00400677    bf44074000     mov edi, str.What_is_the_magic_password_ ; "What is the magic password?" @ 0x400744
|          0x0040067c    e8affeffff     call sym.imp.puts ;sym.imp.puts()
|          0x00400681    488d45fc       lea rax, qword [rbp-local_0_4]
|          0x00400685    4889c6         mov rsi, rax
|          0x00400688    bf60074000     mov edi, 0x400760
|          0x0040068d    b800000000     mov eax, 0
|          0x00400692    e8b9feffff     call sym.imp.scanf ;sym.imp.scanf()
|          0x00400697    8b45fc         mov eax, dword [rbp-local_0_4]
|          0x0040069a    3d745b0000     cmp eax, 0x5b74
|      ,=< 0x0040069f    7516           jne 0x4006b7
|      |   0x004006a1    488d45f0       lea rax, qword [rbp-local_2]
|      |   0x004006a5    4889c6         mov rsi, rax
|      |   0x004006a8    bf63074000     mov edi, str.Correct__Your_flag_is:__s ; "Correct! Your flag is: %s" @ 0x400763
|      |   0x004006ad    b800000000     mov eax, 0
|      |   0x004006b2    e859feffff     call sym.imp.printf ;sym.imp.printf()
|      |   ; JMP XREF from 0x0040069f (sym.main)
|      `-> 0x004006b7    b800000000     mov eax, 0
|          0x004006bc    c9             leave
\          0x004006bd    c3             ret
[0x00400677]> q
</code></pre></div>

The steps :

  - `aaa` : First, analyze all the program fonctions
  - `Ã¬z` : Then print all the strings of the program
  - `pd 10 @ 0x00400744-5`: We show the disassembly around one of the strings. We see that "What is the magic password" is used in `main` at 0x00400677
  - `s 0x00400677` : So we move to 0x00400677
  - `pdf @ 0x00400677` : And we print the disassembly of the function (main).
  - There, we can see the password is compared to `0x5b74` as a numerical value. The password is then this value in decimal : 23412

We found our password, let's feed it to the binary :

<div><pre class="language-bash line-numbers">
<code class="language-bash">root@kali:~/sCTF/Rev1# ./rev1
What is the magic password?
23412
Correct! Your flag is: h4x0r!!!
</code></pre></div>

We did it !

`flag : sctf{h4x0r!!!}`

### Ducks

Write Up To-Do, the website is currently off-line. (If I remember well, I added an input to the form).

### Lengthy Lingo

A quick overview of the file gives us no hint, except that the lines are quite lengthy. Looking at the length, we see that the length of the lines is always under 127, and could always be a printable ascii char.

We wrote this code to convert the length of the lines to characters :

<div><pre class="language-php line-numbers">
<code class="language-php">$file = file_get_contents("encrypted.dat");
$file = explode("\n", $file);
foreach($file as $line){
  echo chr(strlen($line));
}
echo "\n";
</code></pre></div>

Which gave us the `flag : sctf{101_th3_numb3r5_d1dn'7_3v3n_m4tt3r}`

### Rain or Shine

For this one, I realized my method was wrong, but I could not think of any other way of doing it :

The file is a record of the rain in the wav format. Let's see if the file contains other data :

<div><pre class="language-bash line-numbers">
<code class="language-bash">root@kali:~/sCTF/Rain# binwalk rain.wav

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
152318        0x252FE         MySQL ISAM compressed data file Version 2
586865        0x8F471         MySQL ISAM compressed data file Version 5
5669358       0x5681EE        MySQL ISAM index file Version 1
5831936       0x58FD00        TIFF image data, little-endian offset of first image directory: 8
5832467       0x58FF13        Unix path: /www.w3.org/1999/02/22-rdf-syntax-ns#">
5832624       0x58FFB0        Unix path: /purl.org/dc/elements/1.1/"
5832748       0x59002C        Unix path: /ns.adobe.com/xap/1.0/mm/"
5832806       0x590066        Unix path: /ns.adobe.com/xap/1.0/sType/ResourceEvent#">
</code></pre></div>

There we see that there is a TIFF header at 0x58FD00. So I extract it with `dd if=rain.wav of=writeup.tiff bs=1 skip=5831936` which gives me this image :

{% lightbox sctfio-2016q1-rain-scrambled.png %}

We can clearly recognize a QR Code, but it looks scrambled.

After a few minutes of paint, I achieved reconstructing the original QR Code which gives me the `flag : sctf{5t3g0n4gr4phy_i5_fun_r1t3?}`

### Control Panel

// Server down, write up later !

### Musical Penguins

The file is a TuxGuitar tablature. Once opened, we see only two notes, by group of 15 with 5 notes per measure. It looks like morse, so we wanted to transcript this to dots for the E and dashes for the C notes. As they are a lot of notes, we decided to do this automagically.

- Export the file to xml
- Open it with vim
- Let's remove all useless lines: `:%v/fret/d`
- Remove everything that is not a number: `:%s/<fret>//g` and `:%s/<\/fret>//g` and `:%s/\n//g`
- There is a 5 in the middle that stands for a 1 (measure 149): `:%s/5/1/g`
- Replace 2 with dot and 1 with dash: `:%s/2/./g` and `:%s/1/-/g`
- Space every group of 5 char : `qa` four times `right arrow` then `a <space> <esc> <right arrow> q` and finally `145@a` (145 because they are 730 char).
- Using an online morse decoder, we then have a string of numbers between 0 and 6.
- Using the same method than above, we can cut the string into groups of 3 numbers and then convert them from base 7 to base 16 and read the ascii corresponding char

Finally, the `flag : sctf{1_u53d_t0_m4k3_mu51c_w1th_th15_4ll_th3_t1m3}`
